/* only apply to browser elements */
@-moz-document url-prefix("chrome://") {

/* ---------- LAYERS ---------- */
@layer prefs, scope, effect;

/* ---------- 1) USER PREFERENCES ---------- */
@layer prefs {
    :root {
        --splt-blur_radius: var(--mod-alps-spotlight-blur_radius, 6px);
        --splt-brightness: var(--mod-alps-spotlight-brightness, 0.66);
        --splt-transition: var(--mod-alps-spotlight-transition, .20s);
    }

    /* Toggle blur ON if on (independent) */
    @media (-moz-bool-pref: "mod.alps.spotlight.enable_blur") {
        :root {
            --splt-blur-active: var(--splt-blur_radius);
        }
    }

    /* Toggle blur OFF if off (independent) */
    @media not (-moz-bool-pref: "mod.alps.spotlight.enable_blur") {
        :root {
            --splt-blur-active: 0px;
        }
    }

    /* Toggle dim ON if turned on (independent) */
    @media (-moz-bool-pref: "mod.alps.spotlight.enable_dim") {
        :root {
            --splt-bright-active: var(--splt-brightness);
        }
    }

    /* Toggle dim OFF if turned off (independent) */
    @media not (-moz-bool-pref: "mod.alps.spotlight.enable_dim") {
        :root {
            --splt-bright-active: 1;
        }
    }
}

/* ---------- 2) ESTABLISH SCOPE  ---------- */
@layer scope {

    /* If user did not pick docked, neutralize when docked */
    @media not (-moz-bool-pref: "mod.alps.spotlight.on_docked") {
        :root:not(:has(#urlbar[open][zen-floating-urlbar="true"])) {
            --splt-blur-active: 0px;
            --splt-bright-active: 1;
        }
    }

    /* If user did not choose floating, neutralize when floating */
    @media not (-moz-bool-pref: "mod.alps.spotlight.on_floating") {
        :root:has(#urlbar[open][zen-floating-urlbar="true"]) {
            --splt-blur-active: 0px;
            --splt-bright-active: 1;
        }
    }
}

/* ---------- 3) EFFECT APPLICATION ---------- */
@layer effect {

    /* Blur the page content when the URL bar is open */
    :root:has(#urlbar[open]) #tabbrowser-tabpanels {
        filter: blur(var(--splt-blur-active)) brightness(var(--splt-bright-active));
        transition: filter var(--splt-transition) ease;
    }

    /* Keep the bar crisp */
    #urlbar[open] {
        position: relative;
        z-index: 9999;
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
        :root:has(#urlbar[open]) #tabbrowser-tabpanels {
            transition: none !important;
        }
    }
}

}
